<html>
  <head>
    <script type="text/javascript" src="./lib/kuromoji/kuromoji.js"></script>
    <style>
      td{
        border:solid;
      }
    </style>
  </head>
  <body>
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>本部</th>
          <th>タイプ</th>
          <th>サービス</th>
          <th>対応日</th>
          <th>取引先名</th>
          <th>表題</th>
          <th>相手先</th>
          <th>質問</th>
          <th>回答</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </body>
  <script>
    let ccList=[]
    let main =async()=>{
      let data = []
      if(localStorage.getItem("ccList")==null){
          const response = await fetch("/post", {
          method: 'POST', // HTTPメソッドを指定
          mode: 'cors', // クロスオリジンリクエストを許可
          cache: 'no-cache', // キャッシュを使用しない
          credentials: 'same-origin', // クッキーをサーバーに送信
          headers: {
              'Content-Type': 'application/json' // リクエストのコンテンツタイプをJSONに設定
          },
          redirect: 'follow', // リダイレクトを行う場合は、設定をfollowにする
          referrerPolicy: 'no-referrer', // リファラーポリシーを設定しない
        });
        data = await response.json()
        localStorage.setItem("ccList",JSON.stringify(data))
      }else{
        data = JSON.parse(localStorage.getItem("ccList"))
      }

      let filter=["テスト未実施先に、テスト実施依頼メールを送付しました。"]
      for(const originData of data){
        if(filter.find(v=>v==originData[`文字列__複数行__1`].value)!=undefined){
          continue
        }
        let record = {}
        record[`id`] = originData[`レコード番号`].value
        record[`honbu`] = originData[`文字列__1行__22`].value     // 本部
        record[`type`] = originData[`文字列__1行__16`].value      // 応答種類
        record[`service`] = originData[`文字列__1行__11`].value     // サービス
        record[`date`] = originData[`日付_0`].value //対応日
        record[`user`] = originData[`文字列__1行__7`].value       // 取引先名
        record[`title`] = originData[`文字列__1行__20`].value    // 表題
        record[`pic`] = originData[`文字列__1行__19`].value    // 相手先
        record[`question`] = originData[`文字列__複数行__1`].value  // 質問
        record[`answer`] = originData[`文字列__複数行__4`].value  // 回答
        ccList.push(record)
      }
      const table = document.getElementById("tbody")
      table.innerHTML=""

      kuromoji.builder({dicPath:'lib/kuromoji/dict'}).build((err, tokenizer)=>{
        for(const cc of ccList){
          const tokens = tokenizer.tokenize(cc.question)
          tokens.forEach((token)=>{
            console.log(token);
          })
        }
      });
      // 表示
      for(const cc of ccList){
        const tr = document.createElement('tr');
        let td = document.createElement(`td`);td.innerHTML=cc.id;tr.appendChild(td)
        td = document.createElement(`td`);td.innerHTML=cc.honbu;tr.appendChild(td)
        td = document.createElement(`td`);td.innerHTML=cc.type;tr.appendChild(td)
        td = document.createElement(`td`);td.innerHTML=cc.service;tr.appendChild(td)
        td = document.createElement(`td`);td.innerHTML=cc.date;tr.appendChild(td)
        td = document.createElement(`td`);td.innerHTML=cc.user;tr.appendChild(td)
        td = document.createElement(`td`);td.innerHTML=cc.title;tr.appendChild(td)
        td = document.createElement(`td`);td.innerHTML=cc.pic;tr.appendChild(td)
        td = document.createElement(`td`);td.innerText=cc.question;tr.appendChild(td)
        td = document.createElement(`td`);td.innerText=cc.answer;tr.appendChild(td)
        table.appendChild(tr)
      }
    }
    main()
  </script>
</html>
